# kubernetes/applications/argocd-ingress.yaml (Definitive Final Version v8)
apiVersion: argoproj.io/v1alpha1
kind: Application
metadata:
  name: argocd-ingress
  namespace: argocd
  annotations:
    argocd.argoproj.io/sync-wave: "1"
spec:
  project: default
  # CRITICAL CHANGE: Use 'source.inline' instead of 'source.path'
  source:
    inline:
      # Directly embed the Ingress manifest content here
      - apiVersion: networking.k8s.io/v1
        kind: Ingress
        metadata:
          name: argocd-server-ingress
          namespace: argocd
          annotations:
            cert-manager.io/cluster-issuer: cloudflare
            traefik.ingress.kubernetes.io/router.tls: "true"
        spec:
          ingressClassName: traefik
          rules:
          - host: "argocd.core01.prod.gglohh.top"
            http:
              paths:
              - path: /
                pathType: Prefix
                backend:
                  service:
                    name: argocd-server
                    port:
                      name: https
          tls:
          - hosts:
            - "argocd.core01.prod.gglohh.top"
            secretName: argocd-server-tls
  destination:
    server: https://kubernetes.default.svc
    namespace: argocd
  syncPolicy:
    automated:
      prune: true
      selfHeal: true